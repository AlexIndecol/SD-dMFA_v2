dmfa:
  mode: hybrid_stock_driven_for_history_flow_driven_for_future
  stock_driven_years:
    start: 1970
    end: 2025
  observed_stock_variable: in_use_stock_observed_kt
  lifetime_model: weibull
  lifetime_parameters_source: exogenous
  weibull:
    shape_k_variable: lifetime_weibull_shape_k
    scale_lambda_variable: lifetime_weibull_scale_lambda_years
  mass_balance_tolerance: 1.0e-06
  lifetimes:
    distribution: lognormal
    parameterization: mu_sigma
    inputs:
      mu_variable: lifetime_lognormal_mu
      sigma_variable: lifetime_lognormal_sigma
      optional_mean_variable: lifetime_mean_years
      optional_min_variable: lifetime_min_years
      optional_max_variable: lifetime_max_years
    derivation:
      enabled: true
      method: miso2_range_rule
      notes:
      - If mu/sigma are not provided, they can be derived from mean/min/max using
        the MISO2 approach (range rule for std, then lognormal moments).
      - If min/max are missing, derivation cannot proceed; fill mu/sigma directly
        or provide min/max.
    tail_handling:
      max_age_years: 80
      method: lump_tail_to_last_cohort
      notes:
      - If mean lifetime exceeds max_age, survival tail is lumped into the last cohort
        to preserve mass balance.
  end_use_detail:
    enabled: true
    detail_dimension_code: jd
    mapping_file: configs/end_use_detail_mapping.yml
    share_variable: end_use_detail_share_frac
    notes:
    - If end_use_detail_share_frac is provided, the model can compute detail-resolved
      tracking and aggregate back to 7 end-uses.
    - If not provided, all flows remain at the 7 end-use level.
  fallback_calibration:
    new_scrap_fraction_of_demand: 0.05
    eol_outflow_multiplier: 1.0
    export_cap_fraction_by_commodity:
      refined_metal: 0.1
      scrap: 0.2
      concentrate: 0.2
